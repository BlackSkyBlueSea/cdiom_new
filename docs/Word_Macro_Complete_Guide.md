# Word论文自动格式化宏完整指南

## 📋 目录

1. [方案概述](#方案概述)
2. [系统要求与兼容性](#系统要求与兼容性)
3. [完整安装步骤](#完整安装步骤)
   - [方案A：使用现成VBA代码（推荐）](#方案a使用现成vba代码推荐)
   - [方案B：使用录制宏](#方案b使用录制宏)
   - [方案C：不使用宏的简易方案（最简单）⭐](#方案c不使用宏的简易方案最简单)
4. [使用方法](#使用方法)
5. [格式识别规则](#格式识别规则)
6. [格式对照表](#格式对照表)
7. [.docm与.docx格式说明](#docm与docx格式说明)
8. [故障排除](#故障排除)
9. [常见问题](#常见问题)

---

## 方案概述

本指南提供了多种格式化论文的方案，用于应用**广州城市理工学院本科毕业设计（论文）格式要求**：

- **方案A**：使用现成VBA代码（自动识别，一键完成）⭐ 推荐
- **方案B**：使用录制宏（适合学习VBA）
- **方案C**：不使用宏的简易方案（最简单，无需开发工具）⭐ 最简单

### 核心功能

- ✅ 自动识别各级标题（第X章、X.X、X.X.X格式）- 方案A/B
- ✅ 自动格式化摘要、Abstract、关键词 - 方案A/B
- ✅ 自动应用正文格式（小四号宋体、固定行距20磅、首行缩进2字符）- 方案A/B/C
- ✅ 自动格式化参考文献、致谢等特殊部分 - 方案A/B/C
- ✅ 支持Word 2016及以上版本（方案C支持所有版本）

### 选择建议

- **无法使用宏或不想用开发工具**：使用 **方案C**（查找替换/格式刷/样式模板）
- **想要一键自动完成**：使用 **方案A**（现成VBA代码）
- **想学习VBA编程**：使用 **方案B**（录制宏）

---

## 系统要求与兼容性

### ✅ 支持的软件

**Microsoft Office Word**（必须是Microsoft Office，不支持WPS）

- ✅ **Word 2016** - 完全支持
- ✅ **Word 2019** - 完全支持（推荐）
- ✅ **Word 2021** - 完全支持
- ✅ **Microsoft 365 (Office 365)** - 完全支持
- ⚠️ **Word 2013** - 基本支持
- ⚠️ **Word 2010** - 基本支持
- ❌ **Word 2007及更早版本** - 不支持

### ⚙️ 系统要求

- **操作系统**：Windows 10/11（推荐）
- **Mac系统**：部分支持（VBA功能有限，建议Windows）
- **宏安全设置**：需要启用宏功能

### 🚫 不支持的软件

- ❌ **WPS Office** - 不支持VBA
- ❌ **LibreOffice Writer** - 不支持VBA
- ❌ **Google Docs** - 不支持VBA

### 🔍 验证方法

1. **检查Word版本**：文件 → 账户 → 查看版本信息
2. **检查VBA功能**：按 `Alt + F11`，如果能打开VBA编辑器，说明支持VBA
3. **检查宏安全设置**：文件 → 选项 → 信任中心 → 信任中心设置 → 宏设置

---

## 完整安装步骤

本指南提供两种安装方案：
- **方案A：使用现成VBA代码**（推荐）- 直接复制粘贴代码，功能完整
- **方案B：使用录制宏** - 通过录制操作创建宏，适合想学习VBA的用户

---

### 方案A：使用现成VBA代码（推荐）⭐

#### 第一步：启用宏功能（必须）

1. 打开Word，点击 **"文件"** → **"选项"**
2. 点击左侧 **"信任中心"**
3. 点击 **"信任中心设置"** 按钮
4. 选择左侧 **"宏设置"**
5. 选择以下选项之一：
   - ✅ **"禁用无数字签名的宏时发出通知"**（推荐）
   - 或 **"启用所有宏"**（仅用于信任的文档）
6. 点击 **"确定"** 保存设置
7. 再次点击 **"确定"** 关闭对话框

> ⚠️ **注意**：如果选择"启用所有宏"，请确保只打开信任的文档。

### 第二步：准备文档

#### 方法A：创建新文档（推荐）

1. 在Word中，按 `Ctrl + N` 创建新文档
2. 点击 **"文件"** → **"另存为"**
3. 在"保存类型"中选择 **"启用宏的Word文档 (*.docm)"**
4. 输入文件名，点击 **"保存"**

> 💡 **重要**：必须先保存为`.docm`格式，才能添加宏！

#### 方法B：转换现有文档

1. 打开现有`.docx`文档
2. 点击 **"文件"** → **"另存为"**
3. 选择 **"启用宏的Word文档 (*.docm)"** 格式
4. 保存

### 第三步：安装VBA宏代码

1. **打开VBA编辑器**：按 `Alt + F11`
2. **插入模块**：
   - 在左侧"项目资源管理器"中（如果没有显示，按 `Ctrl + R`）
   - 找到你的文档名称（显示为"Project (你的文档名)"）
   - **右键点击你的文档名称**（不是"Normal"）
   - 选择 **"插入"** → **"模块"**
   - 会在右侧打开代码编辑窗口

> ❌ **如果菜单项是灰色的**：说明文档格式不对，请先完成第二步，将文档保存为`.docm`格式。

3. **复制VBA代码**：
   - 打开 `ThesisAutoFormat.vba` 文件（用记事本）
   - 全选所有代码（`Ctrl + A`）
   - 复制代码（`Ctrl + C`）

4. **粘贴代码**：
   - 在VBA编辑器的代码窗口中
   - 粘贴代码（`Ctrl + V`）

5. **保存宏**：
   - 关闭VBA编辑器（按 `Alt + Q` 或点击X）
   - 在Word中按 `Ctrl + S` 保存文档

#### 第四步：验证安装

1. 在Word中，按 `Alt + F8` 打开"宏"对话框
2. 在宏列表中，应该能看到 **"AutoFormatThesis"** 宏
3. 如果能看到，说明安装成功 ✅

---

### 方案B：使用录制宏

录制宏是Word的内置功能，可以记录你的操作并自动生成VBA代码。适合想学习VBA或需要自定义格式的用户。

> ⚠️ **注意**：录制宏只能记录界面操作，无法自动识别不同内容。要实现自动识别功能，需要手动编辑录制的代码。

#### 方法1：录制基础格式宏（简单但需手动选择）

**适用场景**：论文格式已确定，只需要快速应用格式

**步骤**：

1. **准备文档**：
   - 创建或打开`.docm`格式文档
   - 准备示例文本（如一个标题、一段正文）

2. **开始录制宏**：
   - 点击 **"视图"** 选项卡
   - 点击 **"宏"** → **"录制宏"**
   - 在"录制宏"对话框中：
     - 宏名：输入 `FormatTitle1`（一级标题格式）
     - 说明：输入"格式化一级标题"
     - 点击 **"确定"**
   - 鼠标指针会变成录音机图标，表示正在录制

3. **执行格式化操作**（以一级标题为例）：
   - 选中示例标题文本（如"第一章 绪论"）
   - 设置字体：**"开始"** → 字体选择 **"宋体"**，字号选择 **"三号"**，点击 **"加粗"**
   - 设置段落：**"开始"** → **"段落"** → 对齐方式选择 **"居中"**
   - 设置段落间距：**"开始"** → **"段落"** → 段前输入 `12磅`，段后输入 `12磅`
   - 点击 **"确定"**

4. **停止录制**：
   - 点击 **"视图"** → **"宏"** → **"停止录制"**
   - 或者点击状态栏左侧的 **"停止录制"** 按钮

5. **测试宏**：
   - 按 `Alt + F8` 打开宏对话框
   - 选择 `FormatTitle1`，点击 **"运行"**
   - 选中其他标题文本，运行宏测试效果

6. **录制其他格式宏**：
   - 重复步骤2-5，录制以下宏：
     - `FormatTitle2`：二级标题（小三号宋体加粗，左对齐，段前段后12磅）
     - `FormatTitle3`：三级标题（四号宋体加粗，左对齐，无段前段后）
     - `FormatBody`：正文（小四号宋体，固定行距20磅，首行缩进2字符）
     - `FormatAbstract`：摘要标题（三号黑体加粗，居中）
     - `FormatReferences`：参考文献（五号宋体，固定行距20磅）

**使用方法**：
- 手动选中要格式化的文本
- 按 `Alt + F8`，选择对应的宏，点击"运行"
- 重复操作直到所有内容格式化完成

---

#### 方法2：录制+编辑代码（实现自动识别）⭐

**适用场景**：需要自动识别不同内容并应用格式（类似方案A的效果）

**步骤**：

1. **录制基础格式宏**（参考方法1的步骤1-5）
   - 录制 `FormatTitle1`、`FormatTitle2`、`FormatTitle3`、`FormatBody` 等基础格式宏

2. **编辑录制的宏，添加识别逻辑**：
   - 按 `Alt + F11` 打开VBA编辑器
   - 在左侧项目资源管理器中，找到你的文档
   - 展开 **"模块"**，双击录制的宏（如 `FormatTitle1`）
   - 查看录制的代码，类似这样：
     ```vba
     Sub FormatTitle1()
     '
     ' FormatTitle1 宏
     ' 格式化一级标题
     '
         Selection.Font.Name = "宋体"
         Selection.Font.Size = 16
         Selection.Font.Bold = wdToggle
         Selection.ParagraphFormat.Alignment = wdAlignParagraphCenter
         Selection.ParagraphFormat.SpaceBefore = 12
         Selection.ParagraphFormat.SpaceAfter = 12
     End Sub
     ```

3. **创建主宏，添加自动识别逻辑**：
   - 在VBA编辑器中，插入新模块
   - 复制以下代码模板，根据你的需求修改：

   ```vba
   Sub AutoFormatThesis()
       ' 主宏：自动格式化论文
       Dim para As Paragraph
       
       ' 遍历所有段落
       For Each para In ActiveDocument.Paragraphs
           Dim paraText As String
           paraText = Trim(para.Range.Text)
           
           ' 跳过空段落
           If Len(paraText) = 0 Then GoTo NextPara
           
           ' 识别一级标题（第X章格式）
           If InStr(paraText, "第") > 0 And InStr(paraText, "章") > 0 Then
               para.Range.Select
               Call FormatTitle1
           ' 识别三级标题（X.X.X格式，先检查，因为包含二级标题的特征）
           ElseIf IsNumeric(Left(paraText, 1)) And InStr(paraText, ".") > 0 Then
               Dim dotCount As Integer
               dotCount = Len(paraText) - Len(Replace(paraText, ".", ""))
               If dotCount >= 2 Then
                   para.Range.Select
                   Call FormatTitle3
               ' 识别二级标题（X.X格式）
               ElseIf dotCount = 1 Then
                   para.Range.Select
                   Call FormatTitle2
               End If
           ' 识别摘要
           ElseIf paraText = "摘要" Then
               para.Range.Select
               Call FormatAbstract
           ' 识别Abstract
           ElseIf paraText = "Abstract" Then
               para.Range.Select
               Call FormatAbstract
           ' 识别关键词
           ElseIf paraText = "关键词" Or paraText = "Key words" Then
               para.Range.Select
               ' 调用关键词格式宏（需要先录制）
               ' Call FormatKeywords
           ' 其他作为正文
           Else
               para.Range.Select
               Call FormatBody
           End If
   NextPara:
       Next para
   End Sub
   ```

4. **完善识别逻辑**：
   - 根据"格式识别规则"部分，添加更多识别条件
   - 参考方案A的 `ThesisAutoFormat.vba` 代码，学习更完善的识别方法

5. **测试和调试**：
   - 保存代码
   - 在Word中按 `Alt + F8`，运行 `AutoFormatThesis` 宏
   - 检查格式化结果，如有问题，返回VBA编辑器修改代码

---

#### 方法3：使用查找替换+录制宏（半自动）

**适用场景**：论文内容格式统一，可以使用查找替换批量处理

**步骤**：

1. **录制格式宏**（参考方法1）

2. **使用查找替换批量应用格式**：
   - 按 `Ctrl + H` 打开查找替换对话框
   - 点击 **"更多"** → 勾选 **"使用通配符"**
   - **查找一级标题**：
     - 查找内容：不勾选通配符，直接输入 `第*章`
     - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
     - 所有一级标题会被选中
     - 运行 `FormatTitle1` 宏
   - **查找二级标题**：
     - 查找内容：不勾选通配符，直接输入 `[0-9].[0-9]`
     - 选中后运行 `FormatTitle2` 宏
   - **查找三级标题**：
     - 查找内容：不勾选通配符，直接输入 `[0-9].[0-9].[0-9]`
     - 选中后运行 `FormatTitle3` 宏

3. **格式化正文**：
   - 全选文档（`Ctrl + A`）
   - 运行 `FormatBody` 宏
   - 然后手动调整已格式化的标题部分

---

### 录制宏的优缺点

#### ✅ 优点

- **简单易学**：不需要编程知识，只需操作界面
- **直观**：可以看到每一步操作的效果
- **灵活**：可以根据需要自定义格式
- **学习VBA**：录制的代码是学习VBA的好材料

#### ❌ 缺点

- **无法自动识别**：需要手动选择要格式化的内容
- **功能有限**：无法实现复杂的条件判断和循环
- **效率较低**：需要多次运行不同的宏
- **需要编辑代码**：要实现自动识别，必须手动编辑VBA代码

### 推荐方案

- **新手用户**：使用 **方案A**（现成代码），简单快速
- **想学习VBA**：使用 **方案B方法2**（录制+编辑），可以学习VBA编程
- **格式固定**：使用 **方案B方法1**（纯录制），适合格式固定的情况
- **无法使用宏**：使用 **方案C**（不使用宏），最简单直接

---

### 方案C：不使用宏的简易方案（最简单）⭐

**适用场景**：无法使用宏功能、不想使用开发工具、需要最简单的方法

> 💡 **如果查找替换找不到结果**：直接使用 **方法2（格式刷）**，这是最可靠的方法！

**优点**：
- ✅ 不需要任何编程知识
- ✅ 不需要启用宏功能
- ✅ 不需要VBA编辑器
- ✅ 使用Word内置功能即可
- ✅ 适合所有Word版本

**缺点**：
- ⚠️ 需要手动操作，不能一键完成
- ⚠️ 需要按照步骤逐步格式化

---

#### 方法1：使用查找替换批量格式化（推荐）⭐

这是最快的手动方法，利用Word的查找替换功能批量选中相同格式的内容。

**步骤**：

1. **格式化一级标题（第X章格式）**：
   - 按 `Ctrl + H` 打开查找替换对话框
   - 点击 **"更多"** 按钮
   - ⚠️ **重要**：**不勾选"使用通配符"**（因为通配符模式下不支持段落标记）
   - **查找内容**：输入 `第*章`（`*` 表示任意字符）
   - **替换为**：留空
   - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
   - 如果找不到，尝试：
     - **方法A**：直接查找 `第`，然后手动检查选中的内容
     - **方法B**：手动选中第一个一级标题（如"第一章 绪论"），然后使用格式刷（推荐）
   - 选中所有一级标题后，在 **"开始"** 选项卡中设置格式：
     - 字体：**宋体**，字号：**三号**，点击 **"加粗"**
     - 段落：点击 **"居中"**
     - 段落设置：右键 → **"段落"** → 段前：`12磅`，段后：`12磅`

2. **格式化二级标题（X.X格式）**：
   - 在查找替换对话框中
   - ⚠️ **重要**：**不勾选"使用通配符"**
   - **查找内容**：输入 `[0-9].[0-9]`（直接输入，不使用通配符）
   - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
   - ⚠️ **重要**：检查选中的内容，确保是二级标题（如"1.1"、"2.1"），不是三级标题（如"2.1.1"）
   - 如果三级标题也被选中了，需要先格式化三级标题，或者手动排除
   - **推荐方法**：手动选中第一个二级标题（如"1.1 研究背景与意义"），然后使用格式刷
   - 设置格式：
     - 字体：**宋体**，字号：**小三号**，点击 **"加粗"**
     - 段落：**左对齐**
     - 段落设置：段前：`12磅`，段后：`12磅`

3. **格式化三级标题（X.X.X格式）**：
   - 在查找替换对话框中
   - ⚠️ **重要**：**不勾选"使用通配符"**
   - **查找内容**：输入 `[0-9].[0-9].[0-9]`（直接输入，不使用通配符）
   - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
   - ⚠️ **建议**：先格式化三级标题，再格式化二级标题，避免混淆
   - **推荐方法**：手动选中第一个三级标题（如"2.1.1 Spring Boot框架"），然后使用格式刷
   - 设置格式：
     - 字体：**宋体**，字号：**四号**，点击 **"加粗"**
     - 段落：**左对齐**
     - 段落设置：段前：`0磅`，段后：`0磅`

4. **格式化摘要标题**：
   - 在查找替换对话框中
   - **查找内容**：直接输入 `摘要`（不勾选"使用通配符"）
   - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
   - 或者直接手动选中"摘要"文字
   - 设置格式：
     - 字体：**粗黑体**，字号：**三号**，点击 **"加粗"**
     - 段落：**居中**
     - 段落设置：段前：`12磅`，段后：`12磅`
   - **格式化摘要正文**：
     - 手动选中摘要正文部分（摘要标题后到"关键词"之前的内容）
     - 设置格式：**宋体**，**小四号**，行距：**固定值20磅**，首行缩进：**2字符**

5. **格式化Abstract标题**：
   - 在查找替换对话框中
   - **查找内容**：直接输入 `Abstract`（不勾选"使用通配符"）
   - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
   - 或者直接手动选中"Abstract"文字
   - 设置格式：
     - 字体：**Times New Roman**，字号：**三号**，点击 **"加粗"**
     - 段落：**居中**
     - 段落设置：段前：`12磅`，段后：`12磅`
   - **格式化Abstract正文**：
     - 手动选中Abstract正文部分（Abstract标题后到"Key words"之前的内容）
     - 设置格式：**Times New Roman**，**小四号**，行距：**固定值20磅**，首行缩进：**2字符**

6. **格式化关键词标题**：
   - 在查找替换对话框中
   - **查找内容**：直接输入 `关键词`（不勾选"使用通配符"）
   - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
   - 或者直接手动选中"关键词"文字
   - 设置格式：
     - 字体：**黑体**，字号：**小四号**，点击 **"加粗"**
   - **格式化关键词内容**：
     - 手动选中关键词内容（关键词后的文字）
     - 设置格式：**宋体**，**小四号**（不加粗）
     - 确保关键词之间用分号隔开，最后一个关键词不打标点符号

7. **格式化Key words标题**：
   - 在查找替换对话框中
   - **查找内容**：直接输入 `Key words`（不勾选"使用通配符"）
   - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
   - 或者直接手动选中"Key words"文字
   - 设置格式：
     - 字体：**黑体**，字号：**小四号**，点击 **"加粗"**
   - **格式化Key words内容**：
     - 手动选中Key words内容（Key words后的文字）
     - 设置格式：**Times New Roman**，**小四号**（不加粗）
     - 确保关键词之间用分号隔开，最后一个关键词不打标点符号

8. **格式化目录标题**：
   - 在查找替换对话框中
   - **查找内容**：直接输入 `目录`（不勾选"使用通配符"）
   - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
   - 或者直接手动选中"目录"文字
   - 设置格式：
     - 字体：**宋体**，字号：**小三号**，点击 **"加粗"**
     - 段落：**居中**
     - 段落设置：段前：`12磅`，段后：`12磅`

9. **格式化正文**：
   - 按 `Ctrl + A` 全选文档
   - 设置默认格式：
     - 字体：**宋体**，字号：**小四号**
   - 段落设置：
     - 对齐方式：**两端对齐**
     - 行距：**固定值**，设置值：`20磅`
     - 特殊格式：**首行缩进**，度量值：`2字符`
   - 然后重新格式化标题部分（标题格式会覆盖正文格式）

8. **格式化参考文献标题**：
   - **查找内容**：输入 `参考文献^13`
   - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
   - 设置格式：
     - 字体：**宋体**，字号：**三号**，点击 **"加粗"**
     - 段落：**居中**
     - 段落设置：段前：`12磅`，段后：`12磅`

12. **格式化参考文献正文**：
   - 手动选中参考文献列表部分
   - 设置格式：
     - 字体：**宋体**，字号：**五号**
     - 段落设置：行距：**固定值**，`20磅`

13. **格式化致谢标题**：
    - 在查找替换对话框中
    - **查找内容**：直接输入 `致谢`（不勾选"使用通配符"）
    - 点击 **"查找"** → **"在以下项中查找"** → **"主文档"**
    - 或者直接手动选中"致谢"文字
    - 设置格式：
      - 字体：**宋体**，字号：**三号**，点击 **"加粗"**
      - 段落：**居中**
      - 段落设置：段前：`12磅`，段后：`12磅`

14. **格式化致谢正文**：
    - 手动选中致谢正文部分
    - 设置格式：
      - 字体：**宋体**，字号：**五号**
      - 段落设置：行距：**固定值**，`20磅`

---

#### 方法2：使用格式刷（最简单但较慢）⭐ 推荐如果查找替换不工作

适合内容不多的情况，或查找替换无法正常工作时使用。使用格式刷逐个格式化。

**步骤**：

1. **格式化第一个一级标题**：
   - 选中第一个一级标题（如"第一章 绪论"）
   - 设置格式：
     - 字体：**宋体**，字号：**三号**，点击 **"加粗"**
     - 段落：点击 **"居中"**
     - 段落设置：右键 → **"段落"** → 段前：`12磅`，段后：`12磅`
   - 双击 **"格式刷"** 按钮（在"开始"选项卡中，剪贴板区域）
   - 依次点击其他一级标题（如"第二章"、"第三章"等）
   - 完成后，按 `Esc` 键退出格式刷模式

2. **格式化第一个二级标题**：
   - 选中第一个二级标题（如"1.1 研究背景与意义"）
   - 设置格式：
     - 字体：**宋体**，字号：**小三号**，点击 **"加粗"**
     - 段落：**左对齐**
     - 段落设置：段前：`12磅`，段后：`12磅`
   - 双击 **"格式刷"** 按钮
   - 依次点击其他二级标题（如"1.2"、"2.1"、"3.1"等）
   - 完成后，按 `Esc` 键退出格式刷模式

3. **格式化第一个三级标题**：
   - 选中第一个三级标题（如"2.1.1 Spring Boot框架"）
   - 设置格式：
     - 字体：**宋体**，字号：**四号**，点击 **"加粗"**
     - 段落：**左对齐**
     - 段落设置：段前：`0磅`，段后：`0磅`
   - 双击 **"格式刷"** 按钮
   - 依次点击其他三级标题（如"2.1.2"、"4.2.1"等）
   - 完成后，按 `Esc` 键退出格式刷模式

4. **格式化正文**：
   - 选中一段正文（不是标题的普通段落）
   - 设置格式：
     - 字体：**宋体**，字号：**小四号**
     - 段落设置：对齐方式：**两端对齐**，行距：**固定值**，设置值：`20磅`，特殊格式：**首行缩进**，度量值：`2字符`
   - 双击 **"格式刷"** 按钮
   - 依次点击其他正文段落
   - ⚠️ **注意**：跳过已经格式化的标题部分
   - 完成后，按 `Esc` 键退出格式刷模式

5. **格式化摘要标题**：
   - 选中"摘要"
   - 设置格式：**黑体**、**三号**、**加粗**、**居中**、段前段后12磅
   - 使用格式刷应用到其他需要相同格式的标题

6. **格式化Abstract标题**：
   - 选中"Abstract"
   - 设置格式：**Times New Roman**、**三号**、**加粗**、**居中**、段前段后12磅

7. **格式化关键词标题**：
   - 选中"关键词"
   - 设置格式：**黑体**、**小四号**、**加粗**
   - **格式化关键词内容**：
     - 选中关键词后的内容
     - 设置格式：**宋体**、**小四号**（不加粗）
     - 确保关键词之间用分号隔开

8. **格式化Key words标题**：
   - 选中"Key words"
   - 设置格式：**黑体**、**小四号**、**加粗**
   - **格式化Key words内容**：
     - 选中Key words后的内容
     - 设置格式：**Times New Roman**、**小四号**（不加粗）
     - 确保关键词之间用分号隔开

8. **格式化参考文献标题**：
   - 选中"参考文献"
   - 设置格式：**宋体**、**三号**、**加粗**、**居中**、段前段后12磅

12. **格式化致谢标题**：
   - 选中"致谢"
   - 设置格式：**宋体**、**三号**、**加粗**、**居中**、段前段后12磅

10. **格式化参考文献和致谢正文**：
    - 选中参考文献列表或致谢正文
    - 设置格式：**宋体**、**五号**、行距：**固定值20磅**

---

#### 方法3：创建样式模板（一次设置，多次使用）

适合需要格式化多篇论文的情况。

**步骤**：

1. **创建自定义样式**：
   - 点击 **"开始"** → **"样式"** → 点击右下角的小箭头
   - 点击 **"新建样式"** 按钮
   - 创建以下样式：
     - **论文一级标题**：宋体、三号、加粗、居中、段前段后12磅
     - **论文二级标题**：宋体、小三号、加粗、左对齐、段前段后12磅
     - **论文三级标题**：宋体、四号、加粗、左对齐、无段前段后
     - **论文正文**：宋体、小四号、固定行距20磅、首行缩进2字符
     - **摘要标题**：黑体、三号、加粗、居中、段前段后12磅
     - **Abstract标题**：Times New Roman、三号、加粗、居中、段前段后12磅
     - **关键词**：黑体、小四号、加粗
     - **参考文献标题**：宋体、三号、加粗、居中、段前段后12磅
     - **参考文献正文**：宋体、五号、固定行距20磅
     - **致谢正文**：宋体、五号、固定行距20磅

2. **应用样式**：
   - 选中要格式化的文本
   - 在样式列表中选择对应的样式
   - 重复操作直到所有内容格式化完成

3. **保存为模板**（可选）：
   - 格式化完成后，点击 **"文件"** → **"另存为"**
   - 选择 **"Word模板 (*.dotx)"** 格式
   - 保存为模板，以后可以直接使用

---

### 方案C的快速参考表

| 内容类型 | 查找内容（使用通配符） | 备用方法 | 字体 | 字号 | 对齐 | 段前/后 |
|---------|---------------------|---------|------|------|------|---------|
| 一级标题 | 不勾选通配符：`第*章` | 或手动选中后使用格式刷 | 宋体 | 三号 | 居中 | 12磅/12磅 |
| 二级标题 | 不勾选通配符：`[0-9].[0-9]` | 或手动选中后使用格式刷 | 宋体 | 小三号 | 左对齐 | 12磅/12磅 |
| 三级标题 | 不勾选通配符：`[0-9].[0-9].[0-9]` | 或手动选中后使用格式刷 | 宋体 | 四号 | 左对齐 | 0磅/0磅 |
| 摘要标题 | 直接查找：`摘要` | 或手动选中 | 粗黑体 | 三号 | 居中 | 12磅/12磅 |
| 摘要正文 | 手动选中 | - | 宋体 | 小四号 | 两端对齐 | 0磅/0磅 |
| Abstract标题 | 直接查找：`Abstract` | 或手动选中 | Times New Roman | 三号 | 居中 | 12磅/12磅 |
| Abstract正文 | 手动选中 | - | Times New Roman | 小四号 | 两端对齐 | 0磅/0磅 |
| 关键词标题 | 直接查找：`关键词` | 或手动选中 | 黑体 | 小四号 | 左对齐 | - |
| 关键词内容 | 手动选中 | - | 宋体 | 小四号 | 左对齐 | - |
| Key words标题 | 直接查找：`Key words` | 或手动选中 | 黑体 | 小四号 | 左对齐 | - |
| Key words内容 | 手动选中 | - | Times New Roman | 小四号 | 左对齐 | - |
| 目录标题 | 直接查找：`目录` | 或手动选中 | 宋体 | 小三号 | 居中 | 12磅/12磅 |
| 结论标题 | 直接查找：`结论` | 或手动选中 | 宋体 | 三号 | 居中 | 12磅/12磅 |
| 结论正文 | 手动选中 | - | 宋体 | 小四号 | 两端对齐 | 0磅/0磅 |
| 正文 | 全选后设置 | - | 宋体 | 小四号 | 两端对齐 | 0磅/0磅 |
| 参考文献标题 | 直接查找：`参考文献` | 或手动选中 | 宋体 | 三号 | 居中 | 12磅/12磅 |
| 参考文献正文 | 手动选中 | - | 宋体 | 五号 | 左对齐 | 0磅/0磅 |
| 致谢标题 | 直接查找：`致谢` | 或手动选中 | 宋体 | 三号 | 居中 | 12磅/12磅 |
| 致谢正文 | 手动选中 | - | 宋体 | 五号 | 左对齐 | 0磅/0磅 |

> ⚠️ **重要**：使用查找替换时，**不要勾选"使用通配符"**，因为通配符模式下不支持段落标记（`^p` 或 `^13`）。  
> ✅ **推荐**：直接使用格式刷方法（方法2），最简单可靠。

> 💡 **重要提示**：
> - ⚠️ **使用通配符时，不能使用 `^p` 或 `^13`**（段落标记）
> - ✅ **推荐方法**：**不勾选"使用通配符"**，直接查找文字内容
> - ✅ **最简单方法**：使用格式刷方法（方法2），不需要查找替换
> - 查找时，可以点击"查找下一个"逐个查找，而不是"在以下项中查找"
> - 如果查找替换不工作，直接手动选中文字，然后使用格式刷

---

## 使用方法

### 基本使用流程

1. **准备论文内容**：在Word文档中粘贴或输入论文内容
2. **运行宏**：
   - 按 `Alt + F8` 打开宏对话框
   - 选择 **"AutoFormatThesis"**
   - 点击 **"运行"**
3. **检查格式**：查看格式化结果，手动微调需要的地方
4. **删除宏并转换格式**（提交前必须）：
   - 按 `Alt + F11` 打开VBA编辑器
   - 删除文档中的宏模块（右键 → 删除）
   - 在Word中点击"文件" → "另存为"
   - 选择 **"Word文档 (*.docx)"** 格式保存

### 添加到快速访问工具栏（可选）

1. 点击"文件" → "选项" → "快速访问工具栏"
2. 从下拉列表选择"宏"
3. 找到"AutoFormatThesis"宏，点击"添加"
4. 点击"确定"保存

---

## 格式识别规则

宏会自动识别以下内容并应用相应格式：

| 内容类型 | 识别规则 | 应用格式 |
|---------|---------|---------|
| **一级标题** | "第X章"、"绪论"、"结论"、"摘要"、"Abstract"、"目录"、"参考文献"、"附录"、"致谢" | 三号宋体加粗，居中，上下空一行 |
| **二级标题** | "X.X"格式（如"1.1"、"2.3"） | 小三号宋体加粗，左对齐，上下空一行 |
| **三级标题** | "X.X.X"格式（如"1.2.1"、"2.3.4"） | 四号宋体加粗，左对齐，不空行 |
| **摘要标题** | "摘要" | 三号粗黑体，居中，上下空一行 |
| **摘要正文** | 摘要标题后的内容 | 小四号宋体，固定行距20磅，首行缩进2字符 |
| **Abstract标题** | "Abstract" | 三号Times New Roman加粗，居中，上下空一行 |
| **Abstract正文** | Abstract标题后的内容 | 小四号Times New Roman，固定行距20磅，首行缩进2字符 |
| **关键词标题** | "关键词" | 小4号黑体加粗 |
| **关键词内容** | 关键词后的内容 | 宋体小4号字，关键词之间用分号隔开 |
| **Key words标题** | "Key words" | 小4号黑体加粗 |
| **Key words内容** | Key words后的内容 | Times New Roman小4号字，关键词之间用分号隔开 |
| **目录标题** | "目录" | 小三号宋体加粗，居中，上下空一行 |
| **正文** | 其他内容 | 小四号宋体，固定行距20磅，首行缩进2字符 |
| **结论标题** | "结论" | 三号宋体加粗，居中，上下空一行 |
| **结论正文** | 结论标题后的内容 | 小四号宋体，固定行距20磅，首行缩进2字符 |
| **参考文献标题** | "参考文献" | 三号宋体加粗，居中，上下空一行 |
| **参考文献正文** | 参考文献列表 | 五号宋体，固定行距20磅 |
| **致谢标题** | "致谢" | 三号宋体加粗，居中，上下空一行 |
| **致谢正文** | 致谢内容 | 五号宋体，固定行距20磅 |

---

## 格式对照表

| 元素 | 字体 | 字号 | 行距 | 对齐 | 段前/后 | 首行缩进 |
|------|------|------|------|------|---------|----------|
| 一级标题 | 宋体 | 三号(16) | 默认 | 居中 | 12磅/12磅 | 无 |
| 二级标题 | 宋体 | 小三号(15) | 默认 | 左对齐 | 12磅/12磅 | 无 |
| 三级标题 | 宋体 | 四号(14) | 默认 | 左对齐 | 0磅/0磅 | 无 |
| 正文 | 宋体 | 小四号(12) | 20磅 | 两端对齐 | 0磅/0磅 | 2字符 |
| 摘要标题 | 粗黑体 | 三号(16) | 默认 | 居中 | 12磅/12磅 | 无 |
| 摘要正文 | 宋体 | 小四号(12) | 20磅 | 两端对齐 | 0磅/0磅 | 2字符 |
| Abstract标题 | Times New Roman | 三号(16) | 默认 | 居中 | 12磅/12磅 | 无 |
| Abstract正文 | Times New Roman | 小四号(12) | 20磅 | 两端对齐 | 0磅/0磅 | 2字符 |
| 关键词标题 | 黑体 | 小4号(12) | 默认 | 左对齐 | 0磅/0磅 | 无 |
| 关键词内容 | 宋体 | 小4号(12) | 默认 | 左对齐 | 0磅/0磅 | 无 |
| Key words标题 | 黑体 | 小4号(12) | 默认 | 左对齐 | 0磅/0磅 | 无 |
| Key words内容 | Times New Roman | 小4号(12) | 默认 | 左对齐 | 0磅/0磅 | 无 |
| 目录标题 | 宋体 | 小三号(15) | 默认 | 居中 | 12磅/12磅 | 无 |
| 结论标题 | 宋体 | 三号(16) | 默认 | 居中 | 12磅/12磅 | 无 |
| 结论正文 | 宋体 | 小四号(12) | 20磅 | 两端对齐 | 0磅/0磅 | 2字符 |
| 参考文献标题 | 宋体 | 三号(16) | 默认 | 居中 | 12磅/12磅 | 无 |
| 参考文献正文 | 宋体 | 五号(10.5) | 20磅 | 左对齐 | 0磅/0磅 | 无 |
| 致谢标题 | 宋体 | 三号(16) | 默认 | 居中 | 12磅/12磅 | 无 |
| 致谢正文 | 宋体 | 五号(10.5) | 20磅 | 左对齐 | 0磅/0磅 | 无 |

---

## .docm与.docx格式说明

### 格式区别

- **.docx**：标准Word文档，不包含宏代码
- **.docm**：启用宏的Word文档，可以包含VBA宏代码

### ⚠️ 对论文提交的影响

大多数学校要求提交`.docx`格式的论文，`.docm`格式可能：
- ❌ 不被接受：某些学校系统可能拒绝`.docm`文件
- ⚠️ 安全警告：可能触发安全提示
- ⚠️ 兼容性问题：WPS、LibreOffice等可能无法正常打开

### ✅ 解决方案：格式化后删除宏

**步骤**：
1. 运行宏完成格式化
2. 按 `Alt + F11` 打开VBA编辑器
3. 在项目资源管理器中，找到当前文档下的模块
4. 右键点击模块 → **"删除"**
5. 关闭VBA编辑器
6. 在Word中点击"文件" → **"另存为"**
7. 在"保存类型"中选择 **"Word文档 (*.docx)"**
8. 保存

**结果**：新文件是`.docx`格式，不包含宏，但保留了所有格式。

> 💡 **重要**：删除宏不会影响已应用的格式。格式已经应用到文档内容上。

---

## 故障排除

### 问题1：VBA编辑器功能都是灰色的（无法点击）⭐ 最常见

**症状**：打开VBA编辑器后，所有菜单项（插入、文件等）都是灰色的，无法点击。

**原因**：文档是`.docx`格式，不支持宏（需要`.docm`格式）

**解决方法**：
1. **关闭VBA编辑器**（按 `Alt + Q`）
2. 在Word中，点击 **"文件"** → **"另存为"**
3. 在"保存类型"中选择 **"启用宏的Word文档 (*.docm)"**
4. 保存
5. **重新打开VBA编辑器**（`Alt + F11`）
6. 现在应该可以正常插入模块了 ✅

**其他可能原因**：
- 文档被设置为只读：右键文件 → 属性 → 取消"只读"勾选
- 文档被保护：文件 → 信息 → 解除保护

---

### 问题2：无法保存宏 - "无法保存此文件，因为它为只读文件"

**解决方法**：

#### 方案1：保存到当前文档（推荐）⭐

1. 在VBA编辑器中，确保模块是在**当前文档**下（不是"Normal"）
2. 在Word中按 `Ctrl + S` 保存文档
3. 宏会随文档一起保存

#### 方案2：以管理员身份运行Word

1. 关闭所有Word窗口
2. 右键点击Word图标 → **"以管理员身份运行"**
3. 重新打开文档并保存

#### 方案3：修改Normal模板的只读属性

1. 找到Normal模板：`C:\Users\你的用户名\AppData\Roaming\Microsoft\Templates\Normal.dotm`
2. 右键 → "属性" → 取消"只读"勾选
3. 重新打开Word

---

### 问题3：运行时错误5692 - "^不是可用于查找内容框的有效特殊字符"

**原因**：使用了旧版本代码，包含不兼容的通配符语法

**解决方法**：
1. 在VBA编辑器中，删除旧的模块
2. 重新复制 `ThesisAutoFormat.vba` 文件中的**最新代码**
3. 粘贴到新模块中
4. 保存并运行

> ✅ **最新代码已修复此问题**

---

### 问题4：宏运行后格式不正确

**可能原因**：
- 文本内容不符合识别规则
- 文档格式被锁定
- 宏代码未正确执行

**解决方法**：
1. 检查文本格式是否符合要求（如"第X章"、"1.1"等）
2. 尝试手动选择部分文本后运行宏
3. 检查VBA编辑器是否有错误提示

---

### 问题5：找不到宏

**解决方法**：
1. 确认模块已保存
2. 重新打开文档
3. 按 `Alt + F8` 查看宏列表
4. 如果还是没有，重新安装宏

---

## 常见问题

### Q1: 删除宏后格式会丢失吗？
**A:** 不会。格式已经应用到文档内容上，删除宏不会影响已应用的格式。

### Q2: 可以同时保留.docx格式和宏吗？
**A:** 不可以。包含宏的文档必须是`.docm`格式。但可以将宏保存在Normal模板中，文档本身保持`.docx`格式。

### Q3: 学校系统检测到.docm会怎样？
**A:** 取决于学校系统设置，可能拒绝上传或显示安全警告。建议格式化后删除宏并转换为`.docx`格式。

### Q4: 如何确保最终文档是.docx？
**A:** 
1. 删除文档中的宏模块
2. 使用"另存为"，明确选择"Word文档 (*.docx)"
3. 检查文件扩展名确认

### Q5: 我使用的是WPS，可以使用吗？
**A:** 不可以。WPS不支持VBA，需要使用Microsoft Office Word。

### Q6: Mac上的Word可以使用吗？
**A:** 部分支持。Mac版Word的VBA功能有限，建议在Windows系统上使用。

### Q7: 如何撤销宏操作？
**A:** 使用 `Ctrl + Z` 撤销，或关闭文档不保存。

### Q8: 宏保存在哪里？
**A:** 
- 如果保存到当前文档：宏会随文档一起保存，只有打开该文档时才能使用
- 如果保存到Normal模板：宏会保存在所有Word文档中，任何文档都可以使用

### Q9: 录制宏和现成代码有什么区别？
**A:** 
- **现成代码（方案A）**：功能完整，自动识别所有内容，一键完成格式化
- **录制宏（方案B）**：需要手动选择内容，或需要编辑代码添加识别逻辑
- **推荐**：新手使用方案A，想学习VBA使用方案B

### Q10: 录制的宏可以自动识别标题吗？
**A:** 
- **纯录制**：不可以，只能格式化选中的内容
- **录制+编辑代码**：可以，需要手动编辑VBA代码添加识别逻辑（参考方案B方法2）
- **建议**：如果只需要格式化固定内容，使用纯录制；如果需要自动识别，使用方案A或方案B方法2

### Q11: 如何查看录制的宏代码？
**A:** 
1. 按 `Alt + F11` 打开VBA编辑器
2. 在左侧项目资源管理器中，展开"模块"
3. 双击录制的宏名称（如 `FormatTitle1`）
4. 右侧会显示录制的VBA代码

### Q12: 无法使用宏，有其他方法吗？
**A:** 
有！使用 **方案C**（不使用宏的简易方案）：
- **方法1**：使用查找替换批量格式化（最快）
- **方法2**：使用格式刷逐个格式化（最简单）
- **方法3**：创建样式模板（适合多篇论文）
- 详细步骤请参考"方案C"部分

### Q13: 查找替换中的通配符是什么意思？
**A:** 
- `[一二三四五六七八九十]`：匹配中文字符
- `[0-9]`：匹配数字0-9
- `+`：表示前面的字符出现一次或多次
- `*`：匹配任意字符
- ⚠️ **注意**：使用通配符时，不能使用 `^13` 或 `^p`（段落标记）。建议不勾选"使用通配符"，或直接使用格式刷方法。
- 使用前记得勾选"使用通配符"选项

---

## ⚠️ 重要提示

1. **备份文档**：运行宏前请先备份原文档
2. **测试先行**：建议先用部分内容测试效果
3. **手动检查**：某些特殊格式可能需要手动微调
4. **图表处理**：图表标题需要手动检查格式
5. **提交前处理**：格式化完成后，务必删除宏并转换为`.docx`格式

---

## 📚 文件说明

- **ThesisAutoFormat.vba** - VBA宏代码文件（核心文件）
- **Word_Macro_Complete_Guide.md** - 本完整指南

---

**版本信息**：v1.0  
**最后更新**：2026-01-15  
**适用格式**：广州城市理工学院本科毕业设计（论文）格式要求  
**技术支持**：如遇问题，请参考"故障排除"部分


