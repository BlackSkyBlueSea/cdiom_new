# CDIOM - 功能模块详细说明

本文档详细描述了CDIOM系统中已实现的所有功能模块及其功能特性，包括功能模块概览、详细功能说明、项目进度和待实现功能。

## 目录

- [功能模块概览](#功能模块概览)
- [已实现功能模块](#已实现功能模块)
  - [后端模块](#后端模块)
  - [前端模块](#前端模块)
- [项目进度](#项目进度)
  - [项目完成度统计](#项目完成度统计)
  - [待实现功能](#待实现功能)

---

## 功能模块概览

### 后端模块

- ✅ **系统管理模块**：用户管理、角色管理、参数配置、通知公告、操作日志、登录日志
- ✅ **业务管理模块**：药品信息管理、库存管理、入库管理、出库管理、采购订单管理、供应商管理
- ✅ **权限控制模块**：基于角色的权限控制（RBAC）、细粒度权限、权限拦截器
- ✅ **辅助功能模块**：文件上传、仪表盘、认证模块、后端监控

### 前端模块

- ✅ **基础页面**：登录页面、主布局、仪表盘页面
- ✅ **系统管理页面**：用户管理、角色管理、参数配置、通知公告、操作日志、登录日志
- ✅ **业务管理页面**：药品管理、库存管理、入库管理、出库管理、采购订单管理、供应商管理
- ✅ **供应商专用页面**：供应商仪表盘、供应商订单管理
- ✅ **响应式设计**：支持PC端和Pad端访问，适配不同屏幕尺寸

---

## 已实现功能模块

### 后端模块

#### ✅ 用户管理（SysUserController）
- 用户列表查询（分页、关键字搜索、角色筛选、状态筛选）
- 用户新增、编辑、删除（逻辑删除）
- 用户状态管理（启用/禁用）
- 用户解锁功能
- 用户权限管理（用户直接权限关联）

#### ✅ 角色管理（SysRoleController）
- 角色列表查询（分页、关键字搜索、状态筛选）
- 角色新增、编辑、删除（逻辑删除）
- 角色状态管理（启用/禁用）

#### ✅ 参数配置（SysConfigController）
- 参数配置列表查询（分页、关键字搜索、类型筛选）
- 参数配置新增、编辑、删除（逻辑删除）
- 根据键名查询参数配置

#### ✅ 通知公告（SysNoticeController）
- 通知公告列表查询（分页、关键字搜索、类型筛选、状态筛选）
- 通知公告新增、编辑、删除（逻辑删除）
- 通知公告状态管理（开启/关闭）

#### ✅ 操作日志（OperationLogController）
- 操作日志列表查询（分页、多条件筛选）
- 操作日志详情查询

#### ✅ 登录日志（LoginLogController）
- 登录日志列表查询（分页、多条件筛选）
- 登录日志详情查询

#### ✅ 药品信息管理（DrugInfoController）
- 药品信息列表查询（分页、关键字搜索、特殊药品筛选）
- 药品信息新增、编辑、删除（逻辑删除）
- 根据商品码/本位码/追溯码查询（先查本地数据库，未找到则调用极速数据API）
- 根据药品名称查询（调用万维易源API，并自动调用极速数据API补充信息）
- 根据批准文号查询（调用万维易源API，并自动调用极速数据API补充信息）
- 根据供应商ID查询药品列表（新增）
- 多API数据自动合并（万维易源API + 极速数据API）

#### ✅ 供应商-药品关联管理（SupplierDrugController）
- 添加供应商-药品关联（支持设置单价）
- 删除供应商-药品关联
- 更新供应商-药品关联的单价

#### ✅ 采购订单管理（PurchaseOrderController）
- 采购订单列表查询（分页、关键字搜索、状态筛选、供应商筛选）
- 采购订单新增、编辑、删除
- 采购订单状态流转（PENDING → CONFIRMED → SHIPPED → RECEIVED）
- 订单条形码生成（Code128格式，使用订单编号）
- 根据订单编号查询订单详情（用于条形码扫描）
- 订单物流跟踪（物流单号、发货日期）
- 订单状态自动更新（根据入库情况）

#### ✅ 入库管理（InboundRecordController）
- 入库记录列表查询（分页、多条件筛选）
- 创建入库记录（支持从订单入库和临时入库）
- 入库验收流程（效期校验、特殊药品双人操作）
- 根据订单ID查询入库记录
- 已入库数量计算（统计订单的已入库数量）
- 订单状态自动更新（全部入库后更新订单状态为RECEIVED）
- 库存自动更新（入库后自动更新库存表）

#### ✅ 出库管理（OutboundApplyController）
- 出库申请列表查询（分页、多条件筛选）
- 创建出库申请
- 出库申请审批（支持特殊药品双人审批）
- 执行出库操作（FIFO库存扣减）
- 出库申请状态管理（PENDING → APPROVED → OUTBOUND 或 REJECTED）
- 库存自动扣减（出库后自动更新库存表）

#### ✅ 库存调整（InventoryAdjustmentController）
- 库存调整记录列表查询（分页、多条件筛选）
- 创建库存调整记录（盘盈/盘亏）
- 特殊药品双人操作确认
- 库存自动更新（调整后自动更新库存表）
- 调整记录审核功能

#### ✅ 后端监控（BackendMonitorController）
- 获取系统信息（无需登录，公开接口）
- 获取最近的日志（支持日志级别过滤）
- 健康检查端点（系统健康状态）
- WebSocket实时日志推送（通过LogWebSocketHandler实现）

#### ✅ WebSocket日志推送（LogWebSocketHandler）
- 实时日志流推送（WebSocket连接）
- 日志级别过滤
- 心跳保持连接（每30秒）
- 支持多客户端同时连接

#### ✅ 文件上传管理（FileUploadController）
- 图片文件上传（支持jpg, jpeg, png, gif, bmp, webp格式）
- 文件大小验证（最大10MB）
- 文件删除功能
- 按日期分类存储

#### ✅ 仪表盘（DashboardController）
- 基础统计数据（所有用户可访问）
- 登录趋势统计（仅系统管理员）
- 操作日志统计（仅系统管理员）
- 仓库管理员专用仪表盘（近效期预警、待办任务、出入库统计）

#### ✅ 认证模块（AuthController）
- 用户登录（支持用户名/手机号登录）
- 获取当前登录用户信息
- 用户登出

#### ✅ 超级管理员管理（SuperAdminController）
- 超级管理员启用/停用功能
- 邮箱验证码验证（安全验证）
- 超级管理员状态查询
- 验证码发送功能

#### ✅ 权限控制系统
- 基于角色的权限控制（RBAC）
- 用户直接权限关联（支持用户直接拥有权限，实现更细粒度的权限控制）
- 权限拦截器（PermissionInterceptor）
- 权限注解（@RequiresPermission）
- 系统管理员自动拥有所有权限（*）
- 前端权限检查（菜单权限、按钮权限）
- 细粒度权限支持（出库、入库、库存管理等业务权限）

### 前端模块

#### ✅ 登录页面
- 用户名/手机号登录
- 密码加密传输
- Token自动存储到Cookie
- 支持多用户登录模式（sessionStorage）

#### ✅ 首页（Home.jsx）
- 系统首页展示
- 功能特性介绍
- 用户登录入口
- 后端监控中心入口
- 用户信息显示和登出功能

#### ✅ 主布局
- 侧边栏导航菜单
- 顶部用户信息
- 响应式布局

#### ✅ 用户管理页面
- 用户列表展示（分页）
- 用户新增、编辑、删除
- 用户状态管理
- 用户解锁功能

#### ✅ 角色管理页面
- 角色列表展示（分页）
- 角色新增、编辑、删除
- 角色状态管理

#### ✅ 参数配置页面
- 参数配置列表展示（分页）
- 参数配置新增、编辑、删除

#### ✅ 通知公告页面
- 通知公告列表展示（分页）
- 通知公告新增、编辑、删除
- 通知公告状态管理

#### ✅ 操作日志页面
- 操作日志列表展示（分页、多条件筛选）

#### ✅ 登录日志页面
- 登录日志列表展示（分页、多条件筛选）

#### ✅ 仪表盘页面
- 系统管理员仪表盘（基础统计、登录趋势、操作日志统计）
- 仓库管理员仪表盘（近效期预警、待办任务、出入库统计）
- 采购专员仪表盘（订单统计、供应商统计、订单趋势）
- 医护人员仪表盘（申领统计、状态分布、申领趋势）
- 供应商仪表盘（订单统计、状态分布、金额统计、订单趋势）
- 响应式布局（支持不同屏幕尺寸）

#### ✅ 药品管理页面
- 药品信息列表展示（分页、关键字搜索、特殊药品筛选）
- 药品信息新增、编辑、删除
- 四种新增药品方式：
  1. 全部手动输入
  2. 扫描商品码/本位码/追溯码（先查本地，未找到则调用极速数据API）
  3. 输入药品名称搜索（调用万维易源API + 极速数据API）
  4. 输入批准文号搜索（调用万维易源API + 极速数据API）
- 表单自动填充（API返回数据自动填充，用户可手动核对修改）
- 表单布局优化（分组显示，更紧凑美观）
- 特殊药品友好提示（说明如何判断特殊药品）

#### ✅ 供应商管理页面增强
- 供应商列表展示、新增、编辑、删除
- 供应商-药品关联管理（添加、删除、更新单价）
- 根据供应商动态获取关联药品列表
- 采购订单管理优化（根据供应商动态加载药品）

#### ✅ 采购订单管理页面
- 采购订单列表展示（分页、搜索、状态筛选、供应商筛选）
- 采购订单新增、编辑、删除
- 订单状态流转管理
- 订单条形码生成和显示（Code128格式）
- 订单条形码打印功能
- 订单详情查看（包含订单明细、已入库数量、待入库数量）
- 订单物流跟踪（物流单号、发货日期）

#### ✅ 入库管理页面
- 入库记录列表展示（分页、多条件筛选）
- 两种入库方式：
  1. **扫描订单条形码入库**：
     - 扫描订单条形码（或手动输入订单编号）
     - 自动查询订单信息（订单基本信息、订单明细）
     - 显示已入库数量和待入库数量
     - 选择需要入库的药品明细
     - 填写入库信息（批次号、生产日期、有效期、入库数量等）
     - 执行效期校验
     - 特殊药品双人确认
     - 提交入库
  2. **选择订单列表入库**：
     - 显示订单列表（筛选条件：状态=SHIPPED）
     - 选择需要入库的订单
     - 显示订单详情和明细
     - 后续流程同扫描条形码方式
- 入库信息自动填充：
  - 从订单明细自动填充：药品信息、生产厂家、采购数量、待入库数量
  - 需要手动填写：批次号、生产日期、有效期至、入库数量、存储位置
- 临时入库功能（不关联订单）
- 效期校验提示（近效期预警）
- 特殊药品双人操作确认

#### ✅ 供应商仪表盘页面（新增）
- 订单统计（总订单数、状态分布）
- 金额统计（总金额、待确认金额、已确认金额）
- 订单趋势图表（最近7天订单数量趋势）
- 响应式布局

#### ✅ 供应商订单管理页面（新增）
- 供应商订单列表展示（分页、搜索、状态筛选）
- 订单详情查看
- 订单状态管理
- 响应式表格布局

#### ✅ 后端监控页面
- 系统信息展示（CPU、内存、磁盘、JVM信息等）
- 实时日志流查看（WebSocket连接，实时推送日志）
- 日志级别过滤（INFO、WARN、ERROR等）
- 健康检查状态显示
- 日志搜索和筛选功能
- 自动刷新和手动刷新功能
- 支持连接不同后端服务器

#### ✅ 库存管理页面
- 库存列表展示（分页、多条件筛选）
- 库存查询（按药品名称、批次号、存储位置、有效期范围、特殊药品筛选）
- 近效期预警显示（红色预警≤90天、黄色预警90-180天）
- 库存调整功能（盘盈/盘亏，在库存管理页面中集成）
- 库存统计和导出（Excel导出）

---

## 📊 项目进度

### 项目完成度统计

**总体完成度：约 94-97%**

#### 核心业务模块完成度

- ✅ 系统管理模块：100%（用户、角色、配置、通知、日志）
- ✅ 权限管理模块：100%（RBAC、细粒度权限、用户权限关联）
- ✅ 药品管理模块：100%（CRUD、扫码识别、第三方API集成）
- ✅ 库存管理模块：100%（查询、筛选、预警、调整）
- ✅ 供应商管理模块：100%（CRUD、审核、关联管理）
- ✅ 入库管理模块：100%（验收、效期校验、特殊药品双人操作）
- ✅ 出库管理模块：100%（申请、审批、执行、库存扣减）
- ✅ 采购订单管理模块：100%（创建、流转、物流跟踪、条形码）
- ✅ 仪表盘模块：100%（5种角色专用仪表盘）

#### 功能增强完成度

- ✅ 数据可视化：100%（5种角色专用图表）
- ✅ 权限系统：100%（RBAC + 细粒度权限）
- ✅ 文件上传：100%（图片上传、删除、验证）
- ✅ 条形码服务：100%（订单条形码生成）
- ✅ IP定位服务：100%（登录地点识别）
- ✅ 数据导出：100%（Excel导出：药品列表、库存列表、采购订单列表）
- ⏳ 扫码枪适配：0%（HID键盘模式待实现）
- ✅ 响应式优化：100%（PC端完成，Pad端已优化，包含pad-responsive.css）
- ⏳ 常用药品收藏：0%（数据库表已创建，功能待实现）

#### 技术架构完成度

- ✅ 后端架构：100%（Spring Boot + MyBatis-Plus + Spring Security）
- ✅ 前端架构：100%（React + Vite + Ant Design）
- ✅ 数据库设计：100%（21张表全部创建）
- ✅ 安全机制：100%（JWT、BCrypt、权限控制、日志记录）
- ✅ API集成：100%（万维易源API、极速数据API）

### 🚧 待实现功能

#### 功能增强

- ⏳ **扫码枪适配（HID键盘模式）**
  - 目前仅支持条形码生成，未实现扫码枪HID键盘模式自动识别
  - 需要实现：扫码枪输入自动识别、自动填充表单、自动提交等功能

- ⏳ **常用药品收藏功能**
  - 数据库表：`favorite_drug`（已创建）
  - 后端：需要实现 `FavoriteDrugController`、`FavoriteDrugService`
  - 前端：需要实现收藏功能页面和组件
  - 功能需求：
    - 用户可以将常用药品添加到收藏列表
    - 支持收藏列表的增删改查
    - 支持收藏药品的排序
    - 在药品管理页面快速访问收藏的药品

---

**文档创建时间**：2026年1月20日  
**最后更新时间**：2026年1月20日

